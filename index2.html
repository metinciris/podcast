<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <title>Günlük Değişen Podcast Makaleler - Prof. Dr. Metin Çiriş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      margin: 0;
      padding: 0;
      color: #333;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 2.2em;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .content-panel {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      margin-bottom: 25px;
      border: 1px solid #e1e5e9;
      min-height: 200px;
      font-size: 18px;
      line-height: 1.7;
    }

    .player-container {
      position: sticky;
      top: 0;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      margin-bottom: 25px;
      z-index: 100;
      border: 1px solid #e1e5e9;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f1f3f4;
    }

    .player-title {
      font-size: 1.4em;
      font-weight: bold;
      color: #2c3e50;
    }

    .current-track {
      font-size: 0.9em;
      color: #7f8c8d;
      font-style: italic;
    }

    #playerControls {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    button {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 90px;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, #2980b9 0%, #2471a3 100%);
    }

    button:active:not(:disabled) {
      transform: translateY(0);
    }

    button:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #status {
      text-align: center;
      font-style: italic;
      color: #7f8c8d;
      min-height: 20px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 6px;
      font-size: 0.9em;
    }

    .articles-section {
      margin-top: 20px;
    }

    .articles-title {
      font-size: 1.3em;
      color: #2c3e50;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #3498db;
    }

    #articles {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
    }

    #articles li {
      background-color: white;
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
      height: 100%;
    }

    #articles li:hover {
      background-color: #f8f9fa;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border-left: 4px solid #3498db;
    }

    #articles li.active {
      background-color: #e3f2fd;
      font-weight: bold;
      border-left: 4px solid #e74c3c;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .article-title {
      font-size: 14px;
      line-height: 1.4;
      margin: 0;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8em;
      }
      
      .content-panel {
        padding: 20px;
        font-size: 16px;
      }
      
      .player-container {
        padding: 15px;
      }
      
      button {
        padding: 10px 15px;
        font-size: 13px;
        min-width: 80px;
      }
      
      #playerControls {
        gap: 5px;
      }
      
      #articles {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .player-header {
        flex-direction: column;
        gap: 8px;
        text-align: center;
      }
      
      button {
        padding: 8px 12px;
        min-width: 70px;
      }
      
      .content-panel {
        padding: 15px;
        font-size: 15px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Prof. Dr. Metin Çiriş - Podcast Makaleler</h1>
    
    <!-- Büyük İçerik Paneli - E Sütunu Burada Gösterilecek -->
    <div class="content-panel" id="contentPanel">
      Bir makale seçin veya oynat düğmesine basın.
    </div>
    
    <!-- Oynatıcı -->
    <div class="player-container">
      <div class="player-header">
        <div class="player-title">Sesli Oynatıcı</div>
        <div class="current-track" id="currentTrack">Seçili makale yok</div>
      </div>
      
      <div id="playerControls">
        <button id="prevBtn" disabled>⏮️ Önceki</button>
        <button id="playBtn" disabled>▶️ Oynat</button>
        <button id="pauseBtn" disabled>⏸️ Duraklat</button>
        <button id="stopBtn" disabled>⏹️ Durdur</button>
        <button id="nextBtn" disabled>⏭️ Sonraki</button>
      </div>
      
      <div id="status">Bir makale seçin ve oynat'a basın</div>
    </div>
    
    <!-- Makale Listesi -->
    <div class="articles-section">
      <div class="articles-title">Makaleler</div>
      <ul id="articles"></ul>
    </div>
  </div>

  <script>
    const SHEET_ID = '148p3M41R52gVVjtLSF2Qh8rJvBPEWJ7SV4lgSBQYwLc';
    const GID = '1109640564';

    let articles = [];
    let currentIndex = -1;
    let synth = window.speechSynthesis;
    let utterance = null;
    let isPaused = false;

    const articlesEl = document.getElementById('articles');
    const contentPanelEl = document.getElementById('contentPanel');
    const statusEl = document.getElementById('status');
    const prevBtn = document.getElementById('prevBtn');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const nextBtn = document.getElementById('nextBtn');
    const currentTrackEl = document.getElementById('currentTrack');

    // Sesli okutma ayarları
    let voices = [];
    let selectedVoiceTR = null;
    let selectedVoiceEN = null;
    let isReadingDetail = false; // E sütunu mu okunuyor

    function loadVoices() {
      voices = synth.getVoices();
      
      // Türkçe ses bul
      selectedVoiceTR = voices.find(v =>
        v.lang === 'tr-TR' ||
        v.lang.startsWith('tr') ||
        v.name.toLowerCase().includes('turkish') ||
        v.name.toLowerCase().includes('türk')
      );
      
      // İngilizce ses bul
      selectedVoiceEN = voices.find(v =>
        v.lang === 'en-US' ||
        v.lang === 'en-GB' ||
        v.lang.startsWith('en') ||
        v.name.toLowerCase().includes('english')
      );
      
      if (!selectedVoiceTR && voices.length > 0) {
        selectedVoiceTR = voices[0];
      }
      if (!selectedVoiceEN && voices.length > 0) {
        selectedVoiceEN = voices[0];
      }
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    // Google Sheets'ten veri çekme
    async function fetchArticles() {
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}&range=A1:E132`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Veri alınamadı');
        const text = await res.text();
        const jsonText = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
        const data = JSON.parse(jsonText);
        if (!data.table || !data.table.rows) throw new Error('Tablo verisi alınamadı');

        articles = data.table.rows.map(row => {
          let title = row.c[0] && row.c[0].v ? row.c[0].v.toString().trim() : '';
          let detail = row.c[4] && row.c[4].v ? row.c[4].v.toString().trim() : '';
          return { title, detail };
        }).filter(a => a.title.length > 5);

        renderArticleList();
        enableControls();
        statusEl.textContent = `${articles.length} makale yüklendi.`;
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'Makale verileri yüklenemedi.';
        contentPanelEl.innerHTML = '<p style="color: #e74c3c;">Makale verileri yüklenemedi. Lütfen internet bağlantınızı kontrol edin.</p>';
      }
    }

    function renderArticleList() {
      articlesEl.innerHTML = '';
      articles.forEach((article, idx) => {
        const li = document.createElement('li');
        li.innerHTML = `<div class="article-title">${article.title}</div>`;
        li.addEventListener('click', () => {
          playArticle(idx);
        });
        articlesEl.appendChild(li);
      });
    }

    function enableControls() {
      playBtn.disabled = false;
      prevBtn.disabled = true;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      nextBtn.disabled = articles.length <= 1;
    }

    function updateSelection() {
      Array.from(articlesEl.children).forEach((li, idx) => {
        li.classList.toggle('active', idx === currentIndex);
      });
      if (currentIndex >= 0 && currentIndex < articles.length) {
        // E sütunu içeriğini büyük panelde göster
        contentPanelEl.innerHTML = articles[currentIndex].detail || '<p style="color: #7f8c8d; font-style: italic;">Bu makale için detaylı içerik bulunmuyor.</p>';
        
        // A sütunu başlığını oynatıcıda göster
        currentTrackEl.textContent = `${currentIndex + 1}/${articles.length}: ${articles[currentIndex].title.substring(0, 50)}${articles[currentIndex].title.length > 50 ? '...' : ''}`;
      } else {
        contentPanelEl.textContent = 'Bir makale seçin veya oynat düğmesine basın. Burada makalenin detaylı içeriği görünecektir.';
        currentTrackEl.textContent = 'Seçili makale yok';
      }
      prevBtn.disabled = currentIndex <= 0;
      nextBtn.disabled = currentIndex >= articles.length - 1;
    }

    function speak(text, lang = 'tr') {
      if (!text) return;
      if (utterance) {
        synth.cancel();
      }
      utterance = new SpeechSynthesisUtterance(text);
      
      // Dil seçimi
      if (lang === 'en') {
        if (selectedVoiceEN) utterance.voice = selectedVoiceEN;
        utterance.lang = 'en-US';
      } else {
        if (selectedVoiceTR) utterance.voice = selectedVoiceTR;
        utterance.lang = 'tr-TR';
      }
      
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.onend = () => {
        if (!isReadingDetail && articles[currentIndex].detail) {
          // A sütunu bitti, şimdi E sütununu oku
          isReadingDetail = true;
          statusEl.textContent = 'Detay okunuyor... (Türkçe)';
          speak(articles[currentIndex].detail, 'tr');
        } else {
          // E sütunu da bitti veya E sütunu yoktu
          isReadingDetail = false;
          statusEl.textContent = 'Okuma tamamlandı.';
          pauseBtn.disabled = true;
          stopBtn.disabled = true;
          playBtn.disabled = false;
          isPaused = false;
          pauseBtn.textContent = '⏸️ Duraklat';
          
          // Otomatik sonraki makaleye geç
          if (currentIndex < articles.length - 1) {
            setTimeout(() => {
              currentIndex++;
              playArticle(currentIndex);
            }, 500); // 500ms bekle
          }
        }
      };
      utterance.onerror = (e) => {
        console.error('SpeechSynthesis hata:', e);
        statusEl.textContent = 'Sesli okuma sırasında hata meydana geldi.';
      };
      synth.speak(utterance);
      pauseBtn.disabled = false;
      stopBtn.disabled = false;
      playBtn.disabled = true;
    }

    function playArticle(idx) {
      if (idx < 0 || idx >= articles.length) return;
      currentIndex = idx;
      isReadingDetail = false; // Başlıktan başla
      updateSelection();
      statusEl.textContent = 'Başlık okunuyor... (İngilizce)';
      // A sütunu İngilizce oku
      speak(articles[idx].title, 'en');
    }

    function pauseReading() {
      if (synth.speaking && !isPaused) {
        synth.pause();
        isPaused = true;
        statusEl.textContent = 'Okuma duraklatıldı.';
        pauseBtn.textContent = '▶️ Devam Et';
      } else if (synth.paused && isPaused) {
        synth.resume();
        isPaused = false;
        statusEl.textContent = 'Okuma devam ediyor...';
        pauseBtn.textContent = '⏸️ Duraklat';
      }
    }

    function stopReading() {
      if (synth.speaking) {
        synth.cancel();
        isPaused = false;
        isReadingDetail = false;
        statusEl.textContent = 'Okuma durduruldu.';
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        playBtn.disabled = false;
        pauseBtn.textContent = '⏸️ Duraklat';
      }
    }

    function playPrev() {
      if (currentIndex > 0) {
        playArticle(currentIndex - 1);
      }
    }

    function playNext() {
      if (currentIndex < articles.length - 1) {
        playArticle(currentIndex + 1);
      }
    }

    playBtn.addEventListener('click', () => {
      if (currentIndex === -1 && articles.length > 0) {
        playArticle(0);
      } else if (!synth.speaking) {
        playArticle(currentIndex);
      }
    });
    pauseBtn.addEventListener('click', pauseReading);
    stopBtn.addEventListener('click', stopReading);
    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', playNext);

    fetchArticles();
  </script>
</body>

</html>
