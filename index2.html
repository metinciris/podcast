<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <title>Günlük Değişen Podcast Makaleler - Prof. Dr. Metin Çiriş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      margin: 0;
      padding: 0;
      color: #333;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 2.2em;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .content-panel {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      margin-bottom: 25px;
      border: 1px solid #e1e5e9;
      min-height: 200px;
      font-size: 18px;
      line-height: 1.7;
    }

    .player-container {
      position: sticky;
      top: 0;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      margin-bottom: 25px;
      z-index: 100;
      border: 1px solid #e1e5e9;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f1f3f4;
    }

    .player-title {
      font-size: 1.4em;
      font-weight: bold;
      color: #2c3e50;
    }

    .current-track {
      font-size: 0.9em;
      color: #7f8c8d;
      font-style: italic;
    }

    #playerControls {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    button {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 90px;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, #2980b9 0%, #2471a3 100%);
    }

    button:active:not(:disabled) {
      transform: translateY(0);
    }

    button:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #status {
      text-align: center;
      font-style: italic;
      color: #7f8c8d;
      min-height: 20px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 6px;
      font-size: 0.9em;
    }

    .articles-section {
      margin-top: 20px;
    }

    .articles-title {
      font-size: 1.3em;
      color: #2c3e50;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #3498db;
    }

    #articles {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
    }

    #articles li {
      background-color: white;
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
      height: 100%;
    }

    #articles li:hover {
      background-color: #f8f9fa;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border-left: 4px solid #3498db;
    }

    #articles li.active {
      background-color: #e3f2fd;
      font-weight: bold;
      border-left: 4px solid #e74c3c;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .article-title {
      font-size: 14px;
      line-height: 1.4;
      margin: 0;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      h1 { font-size: 1.8em; }
      .content-panel { padding: 20px; font-size: 16px; }
      .player-container { padding: 15px; }
      button { padding: 10px 15px; font-size: 13px; min-width: 80px; }
      #playerControls { gap: 5px; }
      #articles { grid-template-columns: 1fr; }
    }

    @media (max-width: 480px) {
      .player-header { flex-direction: column; gap: 8px; text-align: center; }
      button { padding: 8px 12px; min-width: 70px; }
      .content-panel { padding: 15px; font-size: 15px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Prof. Dr. Metin Çiriş - Podcast Makaleler</h1>
    
    <!-- Büyük İçerik Paneli - E Sütunu Burada Gösterilecek -->
    <div class="content-panel" id="contentPanel">
      Bir makale seçin veya oynat düğmesine basın. Burada makalenin detaylı içeriği (E sütunu) görünecektir.
    </div>
    
    <!-- Oynatıcı -->
    <div class="player-container">
      <div class="player-header">
        <div class="player-title">Sesli Oynatıcı</div>
        <div class="current-track" id="currentTrack">Seçili makale yok</div>
      </div>
      
      <div id="playerControls">
        <button id="prevBtn" disabled>⏮️ Önceki</button>
        <button id="playBtn" disabled>▶️ Oynat</button>
        <button id="pauseBtn" disabled>⏸️ Duraklat</button>
        <button id="stopBtn" disabled>⏹️ Durdur</button>
        <button id="nextBtn" disabled>⏭️ Sonraki</button>
      </div>
      
      <div id="status">Bir makale seçin ve oynat'a basın</div>
    </div>
    
    <!-- Makale Listesi -->
    <div class="articles-section">
      <div class="articles-title">Makaleler (A Sütunu - Sesli Okunacak)</div>
      <ul id="articles"></ul>
    </div>
  </div>

  <script>
    // === AYARLAR ===
    const SHEET_ID = '148p3M41R52gVVjtLSF2Qh8rJvBPEWJ7SV4lgSBQYwLc';
    const GID = '1109640564';
    const EN_LANG = 'en-US'; // İstersen 'en-GB' yap

    // === DURUMLAR ===
    let articles = [];
    let currentIndex = -1;
    let synth = window.speechSynthesis;
    let isPaused = false;

    // DOM referansları sonradan atanacak
    let articlesEl, contentPanelEl, statusEl, prevBtn, playBtn, pauseBtn, stopBtn, nextBtn, currentTrackEl;

    // Sesler
    let voices = [];
    let defaultTRVoice = null;

    function loadVoices() {
      voices = synth.getVoices();
      defaultTRVoice = voices.find(v =>
        v.lang === 'tr-TR' ||
        (v.lang && v.lang.toLowerCase().startsWith('tr')) ||
        (v.name && (v.name.toLowerCase().includes('turkish') || v.name.toLowerCase().includes('türk')))
      ) || voices[0] || null;
    }
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    function pickVoiceByLang(langCode) {
      const all = speechSynthesis.getVoices();
      let v = all.find(v => v.lang === langCode);
      if (!v) {
        const base = langCode.split('-')[0];
        v = all.find(v => v.lang && v.lang.toLowerCase().startsWith(base));
      }
      return v || defaultTRVoice || all[0] || null;
    }

    // Google Sheets'ten veri çekme
    async function fetchArticles() {
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}&range=A1:E132`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Veri alınamadı');
        const text = await res.text();
        const jsonText = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
        const data = JSON.parse(jsonText);
        if (!data.table || !data.table.rows) throw new Error('Tablo verisi alınamadı');

        articles = data.table.rows.map(row => {
          const title = row.c?.[0]?.v ? String(row.c[0].v).trim() : ''; // A sütunu (EN)
          const detail = row.c?.[4]?.v ? String(row.c[4].v).trim() : ''; // E sütunu (TR)
          return { title, detail };
        }).filter(a => a.title.length > 0 || a.detail.length > 0);

        renderArticleList();
        enableControls();
        statusEl.textContent = `${articles.length} makale yüklendi.`;
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'Makale verileri yüklenemedi.';
        contentPanelEl.innerHTML = '<p style="color: #e74c3c;">Makale verileri yüklenemedi. Lütfen internet bağlantınızı kontrol edin.</p>';
      }
    }

    function renderArticleList() {
      articlesEl.innerHTML = '';
      articles.forEach((article, idx) => {
        const li = document.createElement('li');
        li.innerHTML = `<div class="article-title">${article.title || '(Başlık yok)'}</div>`;
        li.addEventListener('click', () => {
          playArticle(idx);
        });
        articlesEl.appendChild(li);
      });
    }

    function enableControls() {
      playBtn.disabled = false;
      prevBtn.disabled = true;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      nextBtn.disabled = articles.length <= 1;
    }

    function updateSelection() {
      Array.from(articlesEl.children).forEach((li, idx) => {
        li.classList.toggle('active', idx === currentIndex);
      });
      if (currentIndex >= 0 && currentIndex < articles.length) {
        // E sütununu büyük panelde göster (HTML içeriği olabilir)
        contentPanelEl.innerHTML = articles[currentIndex].detail || '<p style="color: #7f8c8d; font-style: italic;">Bu makale için detaylı içerik bulunmuyor.</p>';
        const shown = articles[currentIndex].title || '(Başlık yok)';
        currentTrackEl.textContent = `${currentIndex + 1}/${articles.length}: ${shown.substring(0, 50)}${shown.length > 50 ? '...' : ''}`;
      } else {
        contentPanelEl.textContent = 'Bir makale seçin veya oynat düğmesine basın. Burada makalenin detaylı içeriği (E sütunu) görünecektir.';
        currentTrackEl.textContent = 'Seçili makale yok';
      }
      prevBtn.disabled = currentIndex <= 0;
      nextBtn.disabled = currentIndex >= articles.length - 1;
    }

    // Çok parçalı okuma: sırayla EN(A) sonra TR(E)
    function speakSequence(sequence, onAllEnd) {
      if (!sequence || sequence.length === 0) return;
      synth.cancel();

      let i = 0;
      function next() {
        if (i >= sequence.length) {
          onAllEnd && onAllEnd();
          return;
        }
        const seg = sequence[i++];
        const u = new SpeechSynthesisUtterance(seg.text);
        u.lang = seg.lang;
        const v = pickVoiceByLang(seg.lang);
        if (v) u.voice = v;
        // hız ayarı
        u.rate = seg.lang.startsWith('tr') ? 0.9 : 0.95;
        u.pitch = 1.0;

        u.onend = () => next();
        u.onerror = () => next();

        statusEl.textContent = `Okunuyor (${seg.lang})...`;
        pauseBtn.disabled = false;
        stopBtn.disabled = false;
        playBtn.disabled = true;

        speechSynthesis.speak(u);
      }
      next();
    }

    function playArticle(idx) {
      if (idx < 0 || idx >= articles.length) return;
      currentIndex = idx;
      updateSelection();

      const titleEN = articles[idx].title?.trim();   // A sütunu – İngilizce
      const detailTR = articles[idx].detail?.trim(); // E sütunu – Türkçe

      const seq = [];
      if (titleEN)  seq.push({ lang: EN_LANG, text: titleEN });
      if (detailTR) seq.push({ lang: 'tr-TR', text: detailTR });
      if (seq.length === 0) return;

      speakSequence(seq, () => {
        statusEl.textContent = 'Okuma tamamlandı.';
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        playBtn.disabled = false;
        isPaused = false;
        pauseBtn.textContent = '⏸️ Duraklat';

        // Otomatik sonraki
        if (currentIndex < articles.length - 1) {
          currentIndex++;
          playArticle(currentIndex);
        }
      });
    }

    function pauseReading() {
      if (synth.speaking && !isPaused) {
        synth.pause();
        isPaused = true;
        statusEl.textContent = 'Okuma duraklatıldı.';
        pauseBtn.textContent = '▶️ Devam Et';
      } else if (synth.paused && isPaused) {
        synth.resume();
        isPaused = false;
        statusEl.textContent = 'Okuma devam ediyor...';
        pauseBtn.textContent = '⏸️ Duraklat';
      }
    }

    function stopReading() {
      if (synth.speaking || synth.paused) {
        synth.cancel();
        isPaused = false;
        statusEl.textContent = 'Okuma durduruldu.';
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        playBtn.disabled = false;
        pauseBtn.textContent = '⏸️ Duraklat';
      }
    }

    function playPrev() {
      if (currentIndex > 0) {
        playArticle(currentIndex - 1);
      }
    }

    function playNext() {
      if (currentIndex < articles.length - 1) {
        playArticle(currentIndex + 1);
      }
    }

    // DOM yüklendiğinde her şeyi başlat
    function init() {
      articlesEl      = document.getElementById('articles');
      contentPanelEl  = document.getElementById('contentPanel');
      statusEl        = document.getElementById('status');
      prevBtn         = document.getElementById('prevBtn');
      playBtn         = document.getElementById('playBtn');
      pauseBtn        = document.getElementById('pauseBtn');
      stopBtn         = document.getElementById('stopBtn');
      nextBtn         = document.getElementById('nextBtn');
      currentTrackEl  = document.getElementById('currentTrack');

      playBtn.addEventListener('click', () => {
        if (currentIndex === -1 && articles.length > 0) {
          playArticle(0);
        } else if (!speechSynthesis.speaking) {
          playArticle(currentIndex);
        }
      });
      pauseBtn.addEventListener('click', pauseReading);
      stopBtn.addEventListener('click', stopReading);
      prevBtn.addEventListener('click', playPrev);
      nextBtn.addEventListener('click', playNext);

      fetchArticles();
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>
