<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <title>Podcast Makaleler - Prof. Dr. Metin Çiriş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 20px;
      color: #333;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    h1 {
      text-align: center;
      color: #336699;
    }

    #articles {
      margin-top: 20px;
      list-style: none;
      padding: 0;
    }

    #articles li {
      background-color: white;
      border-radius: 8px;
      margin-bottom: 10px;
      padding: 15px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s;
    }

    #articles li:hover {
      background-color: #eef7ff;
    }

    #articles li.active {
      background-color: #d0e4ff;
      font-weight: bold;
    }

    #detail {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      min-height: 90px;
      margin-top: 15px;
      font-size: 16px;
      line-height: 1.4;
    }

    #playerControls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      background-color: #336699;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
      min-width: 90px;
    }

    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      background-color: #264d73;
    }

    #status {
      margin-top: 10px;
      text-align: center;
      font-style: italic;
      color: #555;
      min-height: 20px;
    }
  </style>
</head>

<body>
  <h1>Prof. Dr. Metin Çiriş - Podcast Makaleler</h1>

  <ul id="articles"></ul>

  <div id="detail">Bir makale seçin veya oynat düğmesine basın.</div>

  <div id="playerControls">
    <button id="prevBtn" disabled>⏮️ Önceki</button>
    <button id="playBtn" disabled>▶️ Oynat</button>
    <button id="pauseBtn" disabled>⏸️ Duraklat</button>
    <button id="stopBtn" disabled>⏹️ Durdur</button>
    <button id="nextBtn" disabled>⏭️ Sonraki</button>
  </div>

  <div id="status"></div>

  <script>
    const SHEET_ID = '148p3M41R52gVVjtLSF2Qh8rJvBPEWJ7SV4lgSBQYwLc';
    const GID = '1109640564'; // Veri sayfası Google Sheets baki
    // A sütunu (Türkçe başlıklar) ve E sütunu (detay) çekilecek

    let articles = []; // { title, detail }
    let currentIndex = -1;
    let synth = window.speechSynthesis;
    let utterance = null;
    let isPaused = false;

    const articlesEl = document.getElementById('articles');
    const detailEl = document.getElementById('detail');
    const statusEl = document.getElementById('status');
    const prevBtn = document.getElementById('prevBtn');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const nextBtn = document.getElementById('nextBtn');

    // Sesli okutma ayarları
    let voices = [];
    let selectedVoice = null;

    function loadVoices() {
      voices = synth.getVoices();
      selectedVoice = voices.find(v =>
        v.lang === 'tr-TR' ||
        v.lang.startsWith('tr') ||
        v.name.toLowerCase().includes('turkish') ||
        v.name.toLowerCase().includes('türk')
      );
      if (!selectedVoice && voices.length > 0) {
        selectedVoice = voices[0];
      }
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    // Google Sheets'ten A ve E sütunlarını aynı satırlarda çekmek için
    // Gviz API ile JSONP veri çekme ve JSON parse
    async function fetchArticles() {
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}&range=A1:E132`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Veri alınamadı');
        const text = await res.text();
        const jsonText = text.substring(text.indexOf('(') + 1, text.lastIndexOf(')'));
        const data = JSON.parse(jsonText);
        if (!data.table || !data.table.rows) throw new Error('Tablo verisi alınamadı');

        articles = data.table.rows.map(row => {
          // Satırdaki hücreler A=0, E=4 indexinde olabilir
          // Kontrollü alma
          let title = row.c[0] && row.c[0].v ? row.c[0].v.toString().trim() : '';
          let detail = row.c[4] && row.c[4].v ? row.c[4].v.toString().trim() : '';
          return { title, detail };
        }).filter(a => a.title.length > 5); // Kısa ve boşları at

        renderArticleList();
        enableControls();
        statusEl.textContent = 'Makale verileri yüklendi.';
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'Makale verileri yüklenemedi.';
      }
    }

    function renderArticleList() {
      articlesEl.innerHTML = '';
      articles.forEach((article, idx) => {
        const li = document.createElement('li');
        li.textContent = article.title;
        li.addEventListener('click', () => {
          playArticle(idx);
        });
        articlesEl.appendChild(li);
      });
    }

    function enableControls() {
      playBtn.disabled = false;
      prevBtn.disabled = true;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      nextBtn.disabled = articles.length <= 1;
    }

    function updateSelection() {
      Array.from(articlesEl.children).forEach((li, idx) => {
        li.classList.toggle('active', idx === currentIndex);
      });
      if (currentIndex >= 0 && currentIndex < articles.length) {
        detailEl.innerHTML = articles[currentIndex].detail || 'Açıklama yok.';
      } else {
        detailEl.textContent = 'Bir makale seçin veya oynat düğmesine basın.';
      }
      prevBtn.disabled = currentIndex <= 0;
      nextBtn.disabled = currentIndex >= articles.length - 1;
    }

    function speak(text) {
      if (!text) return;
      if (utterance) {
        synth.cancel();
      }
      utterance = new SpeechSynthesisUtterance(text);
      if (selectedVoice) utterance.voice = selectedVoice;
      utterance.lang = 'tr-TR';
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.onend = () => {
        statusEl.textContent = 'Okuma tamamlandı.';
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        playBtn.disabled = false;
        isPaused = false;
        // Otomatik sonraki varsa çal
        if (currentIndex < articles.length - 1) {
          currentIndex++;
          playArticle(currentIndex);
        }
      };
      utterance.onerror = (e) => {
        console.error('SpeechSynthesis hata:', e);
        statusEl.textContent = 'Sesli okuma sırasında hata meydana geldi.';
      };
      synth.speak(utterance);
      statusEl.textContent = 'Okuma devam ediyor...';
      pauseBtn.disabled = false;
      stopBtn.disabled = false;
      playBtn.disabled = true;
    }

    function playArticle(idx) {
      if (idx < 0 || idx >= articles.length) return;
      currentIndex = idx;
      updateSelection();
      speak(articles[idx].title);
    }

    function pauseReading() {
      if (synth.speaking && !isPaused) {
        synth.pause();
        isPaused = true;
        statusEl.textContent = 'Okuma duraklatıldı.';
        pauseBtn.textContent = '▶️ Devam Et';
      } else if (synth.paused && isPaused) {
        synth.resume();
        isPaused = false;
        statusEl.textContent = 'Okuma devam ediyor...';
        pauseBtn.textContent = '⏸️ Duraklat';
      }
    }

    function stopReading() {
      if (synth.speaking) {
        synth.cancel();
        isPaused = false;
        statusEl.textContent = 'Okuma durduruldu.';
        pauseBtn.disabled = true;
        stopBtn.disabled = true;
        playBtn.disabled = false;
        pauseBtn.textContent = '⏸️ Duraklat';
      }
    }

    function playPrev() {
      if (currentIndex > 0) {
        playArticle(currentIndex - 1);
      }
    }

    function playNext() {
      if (currentIndex < articles.length - 1) {
        playArticle(currentIndex + 1);
      }
    }

    playBtn.addEventListener('click', () => {
      if (currentIndex === -1 && articles.length > 0) {
        playArticle(0);
      } else if (!synth.speaking) {
        playArticle(currentIndex);
      }
    });
    pauseBtn.addEventListener('click', pauseReading);
    stopBtn.addEventListener('click', stopReading);
    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', playNext);

    fetchArticles();
  </script>
</body>

</html>
