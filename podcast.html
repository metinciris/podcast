<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PubMed Makaleleri Podcast Oynatƒ±cƒ±sƒ±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .player-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        button {
            background-color: #336699;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #264d73;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .title-display {
            background-color: #eef7ff;
            border: 1px solid #c7e1ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 50px;
            display: flex;
            align-items: center;
            font-size: 16px;
        }
        .progress {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        input[type="range"] {
            width: 80px;
        }
        .status {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
        .pubmed-link {
            margin: 5px 0 15px 0;
            font-size: 14px;
        }
        .pubmed-link a {
            color: #336699;
            text-decoration: none;
        }
        .pubmed-link a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 600px) {
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            .volume-control {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h2>PubMed Makaleleri Podcast</h2>
        <div class="title-display" id="currentTitle">
            Makale ba≈ülƒ±klarƒ±nƒ± T√ºrk√ße dinlemek i√ßin oynat d√ºƒümesine tƒ±klayƒ±n
        </div>
        <div class="pubmed-link" id="pubmedLink"></div>
        <div id="loadingMessage">Veriler y√ºkleniyor...</div>
        <div class="controls">
            <button id="playButton" disabled>‚ñ∂Ô∏è Oynat</button>
            <button id="pauseButton" disabled>‚è∏Ô∏è Duraklat</button>
            <button id="stopButton" disabled>‚èπÔ∏è Durdur</button>
            <button id="prevButton" disabled>‚èÆÔ∏è √ñnceki</button>
            <button id="nextButton" disabled>‚è≠Ô∏è Sonraki</button>
            <div class="volume-control">
                <label for="volumeControl">Ses Seviyesi:</label>
                <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="1">
            </div>
        </div>
        <div class="progress">
            <span id="currentIndex">0</span>/<span id="totalTitles">0</span> makale
        </div>
        <div class="status" id="status"></div>
    </div>
    
    <script>
        // Google Sheets bilgileri
        const SHEET_ID = '148p3M41R52gVVjtLSF2Qh8rJvBPEWJ7SV4lgSBQYwLc';
        
        // Makale ba≈ülƒ±klarƒ± ve PMID deƒüerleri
        let articleTitles = [];
        let articlePMIDs = [];

        // SpeechSynthesis instance
        const synth = window.speechSynthesis;
        let utterance = null;
        let currentTitleIndex = 0;
        let isPaused = false;
        let voices = [];
        let selectedVoice = null;

        // DOM elements
        const playButton = document.getElementById('playButton');
        const pauseButton = document.getElementById('pauseButton');
        const stopButton = document.getElementById('stopButton');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const currentTitle = document.getElementById('currentTitle');
        const currentIndex = document.getElementById('currentIndex');
        const totalTitles = document.getElementById('totalTitles');
        const volumeControl = document.getElementById('volumeControl');
        const status = document.getElementById('status');
        const loadingMessage = document.getElementById('loadingMessage');
        const pubmedLink = document.getElementById('pubmedLink');

        // Demo ba≈ülƒ±k ve PMID'ler - hata durumunda g√∂sterilecek
        function useDemoTitles() {
            articleTitles = [
                "Yapay Zeka destekli g√∂r√ºnt√º analizi, k√º√ß√ºk h√ºcreli olmayan akciƒüer kanserinde standartla≈ütƒ±rƒ±lmƒ±≈ü programlanmƒ±≈ü √∂l√ºm-ligand 1 ekspresyonu deƒüerlendirmesi i√ßin.",
                "Bifazik (skuamoid) papiller b√∂brek h√ºcreli karsinom: PRCC spektrumu i√ßinde belirgin bir molek√ºler ve morfolojik alt tip.",
                "RPL22 Ekspresyonunun Kaybƒ±, T√ºm√∂rle ƒ∞li≈ükili Lenfosit Sayƒ±larƒ±nƒ±n Daha D√º≈ü√ºk Olduƒüu MLH1 Eksik Endometriyal Kanserlerin Transkripsiyonel Bir Alt K√ºmesini Belirler.",
                "Histopatolojik ƒ∞√ßg√∂r√ºler Curvularia-ƒ∞nd√ºklenen Kronik Gran√ºlomat√∂z Fungal Sin√ºzit: Cerrahi Patologlar ƒ∞√ßin Bir Rehber.",
                "ALK-Yeniden D√ºzenlenmi≈ü Mezenkimal Neoplazm Hiyalin-Vask√ºler Castleman Hastalƒ±ƒüƒ± Benzeri √ñzelliklerle: Bir Olgu Sunumu."
            ];
            
            articlePMIDs = [
                "41013460",
                "41006900",
                "41005533",
                "41005534",
                "41001954"
            ];
            
            totalTitles.textContent = articleTitles.length;
            loadingMessage.style.display = 'none';
            enablePlayerControls();
        }

        // Google Sheets'ten veri √ßek
        async function fetchSheetData() {
            try {
                loadingMessage.textContent = "Google Sheets'ten veriler y√ºkleniyor...";
                
                // JSONP formatƒ±nda verileri al
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=translate&gid=1844098177`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Google Sheets verisi alƒ±namadƒ±');
                }
                
                const responseText = await response.text();
                
                // JSONP yanƒ±tƒ±nƒ± JSON'a d√∂n√º≈üt√ºrme
                const jsonText = responseText.substring(
                    responseText.indexOf('(') + 1, 
                    responseText.lastIndexOf(')')
                );
                
                try {
                    const data = JSON.parse(jsonText);
                    
                    if (data.table && data.table.rows) {
                        console.log("Bulunan satƒ±r sayƒ±sƒ±:", data.table.rows.length);
                        
                        // Debug i√ßin ilk 5 satƒ±rƒ± g√∂ster
                        console.log("ƒ∞lk 5 satƒ±r:", data.table.rows.slice(0, 5));
                        
                        // Ge√ßici diziler
                        const titles = [];
                        const pmids = [];
                        
                        // Her satƒ±r i√ßin veri al
                        data.table.rows.forEach((row, index) => {
                            if (row.c) {
                                // A s√ºtunu (ba≈ülƒ±k)
                                const title = row.c[0] && row.c[0].v ? row.c[0].v.toString().trim() : "";
                                
                                // F s√ºtunu (PMID) i√ßin indeks 5 kullanƒ±lmalƒ± (A=0, B=1, ..., F=5)
                                const pmid = row.c[5] && row.c[5].v ? row.c[5].v.toString().trim() : "";
                                
                                // Dergi ba≈ülƒ±klarƒ±nƒ± filtrele
                                const isDergiAdi = title.includes('üìò') || 
                                                 title.includes('[resmi sayfa]') || 
                                                 title.length < 10 ||
                                                 /Journal|Pathology|Archiv|APMIS|Histopathology/i.test(title);
                                
                                // Sadece makale ba≈ülƒ±klarƒ±nƒ± al
                                if (title && !isDergiAdi) {
                                    titles.push(title);
                                    pmids.push(pmid);
                                    console.log(`Satƒ±r ${index+1}: Ba≈ülƒ±k="${title}", PMID=${pmid}`);
                                }
                            }
                        });
                        
                        console.log("ƒ∞≈ülenen ba≈ülƒ±k sayƒ±sƒ±:", titles.length);
                        
                        if (titles.length > 0) {
                            // Makale ba≈ülƒ±k ve PMID'lerini kaydet
                            articleTitles = titles;
                            articlePMIDs = pmids;
                            
                            // UI'ƒ± g√ºncelle
                            totalTitles.textContent = articleTitles.length;
                            loadingMessage.style.display = 'none';
                            enablePlayerControls();
                        } else {
                            throw new Error('ƒ∞≈ülenebilir ba≈ülƒ±k bulunamadƒ±');
                        }
                    } else {
                        throw new Error('Tablo verileri alƒ±namadƒ±');
                    }
                } catch (jsonError) {
                    console.error('JSON ayrƒ±≈ütƒ±rma hatasƒ±:', jsonError);
                    console.log('Alƒ±nan JSON yanƒ±tƒ±:', jsonText);
                    throw new Error('Veri formatƒ± okunamadƒ±');
                }
            } catch (error) {
                console.error('Veri alma hatasƒ±:', error);
                loadingMessage.textContent = 'Google Sheets verileri y√ºklenemedi - Demo ba≈ülƒ±klar kullanƒ±lƒ±yor';
                
                // Varsayƒ±lan ba≈ülƒ±klara ge√ß
                useDemoTitles();
            }
        }
        
        // Oynatƒ±cƒ± kontrollerini etkinle≈ütir
        function enablePlayerControls() {
            playButton.disabled = false;
            prevButton.disabled = true; // ƒ∞lk ba≈üta √∂nceki d√ºƒümesi devre dƒ±≈üƒ±
            nextButton.disabled = articleTitles.length <= 1; // Tek makale varsa sonraki d√ºƒümesi devre dƒ±≈üƒ±
            status.textContent = "Hazƒ±r";
        }

        // Initialize the UI and load data
        function init() {
            // Google Sheets'ten veri √ßek
            fetchSheetData();
            
            // Kullanƒ±labilir sesleri y√ºkle
            loadVoices();
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = loadVoices;
            }

            // Event listener'larƒ± kur
            playButton.addEventListener('click', play);
            pauseButton.addEventListener('click', pause);
            stopButton.addEventListener('click', stop);
            prevButton.addEventListener('click', previous);
            nextButton.addEventListener('click', next);
            volumeControl.addEventListener('input', updateVolume);
        }

        // Kullanƒ±labilir sesleri y√ºkle ve T√ºrk√ßeyi se√ß
        function loadVoices() {
            voices = synth.getVoices();
            
            // T√ºrk√ße sesi bulmayƒ± dene
            selectedVoice = voices.find(voice => 
                voice.lang === 'tr-TR' || 
                voice.lang === 'tr' || 
                voice.name.toLowerCase().includes('turkish') ||
                voice.name.toLowerCase().includes('t√ºrk')
            );
            
            // T√ºrk√ße ses bulunamadƒ±ysa herhangi bir ses kullan
            if (!selectedVoice) {
                console.warn('T√ºrk√ße ses bulunamadƒ±, varsayƒ±lan ses kullanƒ±lƒ±yor.');
                selectedVoice = voices.find(voice => voice.default) || voices[0];
            }
            
            if (selectedVoice) {
                console.log('Se√ßilen ses:', selectedVoice.name, selectedVoice.lang);
            }
            
            // Eƒüer veri ve ses y√ºklenmi≈ü ise oynatƒ±cƒ±yƒ± etkinle≈ütir
            if (articleTitles.length > 0 && voices.length > 0) {
                enablePlayerControls();
            }
        }

        // Yeni konu≈üma olu≈ütur
        function createUtterance(text) {
            utterance = new SpeechSynthesisUtterance(text);
            
            // Se√ßilen T√ºrk√ße sesi kullan
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            
            // T√ºrk√ße telaffuz i√ßin optimal parametreler
            utterance.lang = 'tr-TR'; // T√ºrk√ße dili zorla
            utterance.pitch = 1.0;    // Normal ton
            utterance.rate = 0.9;     // Netlik i√ßin biraz yava≈ü
            utterance.volume = parseFloat(volumeControl.value);
            
            // Konu≈üma bittiƒüinde yapƒ±lacaklar
            utterance.onend = () => {
                if (!isPaused) {
                    // Sonraki ba≈ülƒ±ƒüa ge√ß
                    if (currentTitleIndex < articleTitles.length - 1) {
                        currentTitleIndex++;
                        speakCurrentTitle();
                    } else {
                        // T√ºm ba≈ülƒ±klar okundu
                        resetPlayer();
                        status.textContent = "Makalelerin sonuna ula≈üƒ±ldƒ±";
                    }
                }
            };

            utterance.onerror = (event) => {
                console.error('SpeechSynthesis hatasƒ±:', event);
                status.textContent = "Konu≈üma sƒ±rasƒ±nda bir hata olu≈ütu";
            };
        }

        // ≈ûu anki ba≈ülƒ±ƒüƒ± oku
        function speakCurrentTitle() {
            updateDisplay();
            
            const title = articleTitles[currentTitleIndex];
            createUtterance(title);
            synth.speak(utterance);
            
            status.textContent = "Konu≈üuyor...";
            updateButtonState(true);
        }

        // G√∂r√ºnt√ºy√º g√ºncelle
        function updateDisplay() {
            // Ba≈ülƒ±ƒüƒ± g√∂ster
            currentTitle.textContent = articleTitles[currentTitleIndex];
            
            // PMID varsa PubMed linkini g√∂ster
            const pubmedLink = document.getElementById('pubmedLink');
            const pmid = articlePMIDs[currentTitleIndex];
            
            if (pmid && pmid.trim() !== "") {
                pubmedLink.innerHTML = `<a href="https://pubmed.ncbi.nlm.nih.gov/${pmid}" target="_blank">PubMed: ${pmid}</a>`;
            } else {
                pubmedLink.innerHTML = "";
            }
            
            // ƒ∞ndeksi g√ºncelle
            currentIndex.textContent = currentTitleIndex + 1;
        }

        // D√ºƒüme durumlarƒ±nƒ± g√ºncelle
        function updateButtonState(isPlaying) {
            playButton.disabled = isPlaying;
            pauseButton.disabled = !isPlaying;
            stopButton.disabled = !isPlaying;
            prevButton.disabled = currentTitleIndex === 0 || isPlaying;
            nextButton.disabled = currentTitleIndex >= articleTitles.length - 1 || isPlaying;
        }

        // Oynatƒ±cƒ±yƒ± sƒ±fƒ±rla
        function resetPlayer() {
            synth.cancel();
            isPaused = false;
            updateButtonState(false);
            status.textContent = "Hazƒ±r";
        }

        // Event handler'lar
        function play() {
            if (synth.speaking && isPaused) {
                // Duraklatƒ±lmƒ±≈üsa devam et
                synth.resume();
                isPaused = false;
                status.textContent = "Konu≈üuyor...";
            } else {
                // Yeni konu≈üma ba≈ülat
                speakCurrentTitle();
            }
            updateButtonState(true);
        }

        function pause() {
            if (synth.speaking) {
                synth.pause();
                isPaused = true;
                status.textContent = "Duraklatƒ±ldƒ±";
            }
        }

        function stop() {
            resetPlayer();
        }

        function previous() {
            if (currentTitleIndex > 0) {
                currentTitleIndex--;
                updateDisplay();
            }
        }

        function next() {
            if (currentTitleIndex < articleTitles.length - 1) {
                currentTitleIndex++;
                updateDisplay();
            }
        }

        function updateVolume() {
            if (utterance) {
                utterance.volume = parseFloat(volumeControl.value);
            }
        }

        // Sayfa y√ºklendiƒüinde ba≈ülat
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
