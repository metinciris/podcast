<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PubMed Makaleleri Podcast OynatÄ±cÄ±sÄ±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .player-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        button {
            background-color: #336699;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #264d73;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .title-display {
            background-color: #eef7ff;
            border: 1px solid #c7e1ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 50px;
            display: flex;
            align-items: center;
            font-size: 16px;
        }
        .progress {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        input[type="range"] {
            width: 80px;
        }
        .status {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
        .pubmed-link {
            margin: 5px 0 15px 0;
            font-size: 14px;
        }
        .pubmed-link a {
            color: #336699;
            text-decoration: none;
        }
        .pubmed-link a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 600px) {
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            .volume-control {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h2>PubMed Makaleleri Podcast</h2>
        <div class="title-display" id="currentTitle">
            Makale baÅŸlÄ±klarÄ±nÄ± TÃ¼rkÃ§e dinlemek iÃ§in oynat dÃ¼ÄŸmesine tÄ±klayÄ±n
        </div>
        <div class="pubmed-link" id="pubmedLink"></div>
        <div id="loadingMessage">Veriler yÃ¼kleniyor...</div>
        <div class="controls">
            <button id="playButton" disabled>â–¶ï¸ Oynat</button>
            <button id="pauseButton" disabled>â¸ï¸ Duraklat</button>
            <button id="stopButton" disabled>â¹ï¸ Durdur</button>
            <button id="prevButton" disabled>â®ï¸ Ã–nceki</button>
            <button id="nextButton" disabled>â­ï¸ Sonraki</button>
            <div class="volume-control">
                <label for="volumeControl">Ses Seviyesi:</label>
                <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="1">
            </div>
        </div>
        <div class="progress">
            <span id="currentIndex">0</span>/<span id="totalTitles">0</span> makale
        </div>
        <div class="status" id="status"></div>
    </div>
    
    <script>
        // Google Sheets bilgileri
        const SHEET_ID = '148p3M41R52gVVjtLSF2Qh8rJvBPEWJ7SV4lgSBQYwLc';
        
        // Makale baÅŸlÄ±klarÄ± ve PMID deÄŸerleri
        let articleTitles = [];
        let articlePMIDs = [];

        // SpeechSynthesis instance
        const synth = window.speechSynthesis;
        let utterance = null;
        let currentTitleIndex = 0;
        let isPaused = false;
        let voices = [];
        let selectedVoice = null;

        // DOM elements
        const playButton = document.getElementById('playButton');
        const pauseButton = document.getElementById('pauseButton');
        const stopButton = document.getElementById('stopButton');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const currentTitle = document.getElementById('currentTitle');
        const currentIndex = document.getElementById('currentIndex');
        const totalTitles = document.getElementById('totalTitles');
        const volumeControl = document.getElementById('volumeControl');
        const status = document.getElementById('status');
        const loadingMessage = document.getElementById('loadingMessage');
        const pubmedLink = document.getElementById('pubmedLink');

        // Demo baÅŸlÄ±k ve PMID'ler - hata durumunda gÃ¶sterilecek
        function useDemoTitles() {
            articleTitles = [
                "Yapay Zeka destekli gÃ¶rÃ¼ntÃ¼ analizi, kÃ¼Ã§Ã¼k hÃ¼creli olmayan akciÄŸer kanserinde standartlaÅŸtÄ±rÄ±lmÄ±ÅŸ programlanmÄ±ÅŸ Ã¶lÃ¼m-ligand 1 ekspresyonu deÄŸerlendirmesi iÃ§in.",
                "Bifazik (skuamoid) papiller bÃ¶brek hÃ¼creli karsinom: PRCC spektrumu iÃ§inde belirgin bir molekÃ¼ler ve morfolojik alt tip.",
                "RPL22 Ekspresyonunun KaybÄ±, TÃ¼mÃ¶rle Ä°liÅŸkili Lenfosit SayÄ±larÄ±nÄ±n Daha DÃ¼ÅŸÃ¼k OlduÄŸu MLH1 Eksik Endometriyal Kanserlerin Transkripsiyonel Bir Alt KÃ¼mesini Belirler.",
                "Histopatolojik Ä°Ã§gÃ¶rÃ¼ler Curvularia-Ä°ndÃ¼klenen Kronik GranÃ¼lomatÃ¶z Fungal SinÃ¼zit: Cerrahi Patologlar Ä°Ã§in Bir Rehber.",
                "ALK-Yeniden DÃ¼zenlenmiÅŸ Mezenkimal Neoplazm Hiyalin-VaskÃ¼ler Castleman HastalÄ±ÄŸÄ± Benzeri Ã–zelliklerle: Bir Olgu Sunumu."
            ];
            
            articlePMIDs = [
                "41013460",
                "41006900",
                "41005533",
                "41005534",
                "41001954"
            ];
            
            totalTitles.textContent = articleTitles.length;
            loadingMessage.style.display = 'none';
            enablePlayerControls();
        }

        // Google Sheets'ten veri Ã§ek
        async function fetchSheetData() {
            try {
                loadingMessage.textContent = "Google Sheets'ten veriler yÃ¼kleniyor...";
                
                // JSONP formatÄ±nda verileri al
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=translate&gid=1844098177`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Google Sheets verisi alÄ±namadÄ±');
                }
                
                const responseText = await response.text();
                
                // JSONP yanÄ±tÄ±nÄ± JSON'a dÃ¶nÃ¼ÅŸtÃ¼rme
                const jsonText = responseText.substring(
                    responseText.indexOf('(') + 1, 
                    responseText.lastIndexOf(')')
                );
                
                try {
                    const data = JSON.parse(jsonText);
                    
                    if (data.table && data.table.rows) {
                        console.log("Bulunan satÄ±r sayÄ±sÄ±:", data.table.rows.length);
                        
                        // Debug iÃ§in ilk 5 satÄ±rÄ± gÃ¶ster
                        console.log("Ä°lk 5 satÄ±r:", data.table.rows.slice(0, 5));
                        
                        // GeÃ§ici diziler
                        const titles = [];
                        const pmids = [];
                        
                        // Her satÄ±r iÃ§in veri al
                        data.table.rows.forEach((row, index) => {
                            if (row.c) {
                                // A sÃ¼tunu (baÅŸlÄ±k)
                                const title = row.c[0] && row.c[0].v ? row.c[0].v.toString().trim() : "";
                                
                                // F sÃ¼tunu (PMID) iÃ§in indeks 5 kullanÄ±lmalÄ± (A=0, B=1, ..., F=5)
                                const pmid = row.c[5] && row.c[5].v ? row.c[5].v.toString().trim() : "";
                                
                                // Dergi baÅŸlÄ±klarÄ±nÄ± filtrele
                                const isDergiAdi = title.includes('ğŸ“˜') || 
                                                 title.includes('[resmi sayfa]') || 
                                                 title.length < 10 ||
                                                 /Journal|Pathology|Archiv|APMIS|Histopathology/i.test(title);
                                
                                // Sadece makale baÅŸlÄ±klarÄ±nÄ± al
                                if (title && !isDergiAdi) {
                                    titles.push(title);
                                    pmids.push(pmid);
                                    console.log(`SatÄ±r ${index+1}: BaÅŸlÄ±k="${title}", PMID=${pmid}`);
                                }
                            }
                        });
                        
                        console.log("Ä°ÅŸlenen baÅŸlÄ±k sayÄ±sÄ±:", titles.length);
                        
                        if (titles.length > 0) {
                            // Makale baÅŸlÄ±k ve PMID'lerini kaydet
                            articleTitles = titles;
                            articlePMIDs = pmids;
                            
                            // UI'Ä± gÃ¼ncelle
                            totalTitles.textContent = articleTitles.length;
                            loadingMessage.style.display = 'none';
                            enablePlayerControls();
                        } else {
                            throw new Error('Ä°ÅŸlenebilir baÅŸlÄ±k bulunamadÄ±');
                        }
                    } else {
                        throw new Error('Tablo verileri alÄ±namadÄ±');
                    }
                } catch (jsonError) {
                    console.error('JSON ayrÄ±ÅŸtÄ±rma hatasÄ±:', jsonError);
                    console.log('AlÄ±nan JSON yanÄ±tÄ±:', jsonText);
                    throw new Error('Veri formatÄ± okunamadÄ±');
                }
            } catch (error) {
                console.error('Veri alma hatasÄ±:', error);
                loadingMessage.textContent = 'Google Sheets verileri yÃ¼klenemedi - Demo baÅŸlÄ±klar kullanÄ±lÄ±yor';
                
                // VarsayÄ±lan baÅŸlÄ±klara geÃ§
                useDemoTitles();
            }
        }
        
        // OynatÄ±cÄ± kontrollerini etkinleÅŸtir
        function enablePlayerControls() {
            playButton.disabled = false;
            prevButton.disabled = true; // Ä°lk baÅŸta Ã¶nceki dÃ¼ÄŸmesi devre dÄ±ÅŸÄ±
            nextButton.disabled = articleTitles.length <= 1; // Tek makale varsa sonraki dÃ¼ÄŸmesi devre dÄ±ÅŸÄ±
            status.textContent = "HazÄ±r";
        }

        // Initialize the UI and load data
        function init() {
            // Google Sheets'ten veri Ã§ek
            fetchSheetData();
            
            // KullanÄ±labilir sesleri yÃ¼kle
            loadVoices();
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = loadVoices;
            }

            // Event listener'larÄ± kur
            playButton.addEventListener('click', play);
            pauseButton.addEventListener('click', pause);
            stopButton.addEventListener('click', stop);
            prevButton.addEventListener('click', previous);
            nextButton.addEventListener('click', next);
            volumeControl.addEventListener('input', updateVolume);
        }

        // KullanÄ±labilir sesleri yÃ¼kle ve TÃ¼rkÃ§eyi seÃ§
        function loadVoices() {
            voices = synth.getVoices();
            
            // TÃ¼rkÃ§e sesi bulmayÄ± dene
            selectedVoice = voices.find(voice => 
                voice.lang === 'tr-TR' || 
                voice.lang === 'tr' || 
                voice.name.toLowerCase().includes('turkish') ||
                voice.name.toLowerCase().includes('tÃ¼rk')
            );
            
            // TÃ¼rkÃ§e ses bulunamadÄ±ysa herhangi bir ses kullan
            if (!selectedVoice) {
                console.warn('TÃ¼rkÃ§e ses bulunamadÄ±, varsayÄ±lan ses kullanÄ±lÄ±yor.');
                selectedVoice = voices.find(voice => voice.default) || voices[0];
            }
            
            if (selectedVoice) {
                console.log('SeÃ§ilen ses:', selectedVoice.name, selectedVoice.lang);
            }
            
            // EÄŸer veri ve ses yÃ¼klenmiÅŸ ise oynatÄ±cÄ±yÄ± etkinleÅŸtir
            if (articleTitles.length > 0 && voices.length > 0) {
                enablePlayerControls();
            }
        }

        // Yeni konuÅŸma oluÅŸtur
        function createUtterance(text) {
            utterance = new SpeechSynthesisUtterance(text);
            
            // SeÃ§ilen TÃ¼rkÃ§e sesi kullan
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            
            // TÃ¼rkÃ§e telaffuz iÃ§in optimal parametreler
            utterance.lang = 'tr-TR'; // TÃ¼rkÃ§e dili zorla
            utterance.pitch = 1.0;    // Normal ton
            utterance.rate = 0.9;     // Netlik iÃ§in biraz yavaÅŸ
            utterance.volume = parseFloat(volumeControl.value);
            
            // KonuÅŸma bittiÄŸinde yapÄ±lacaklar
            utterance.onend = () => {
                if (!isPaused) {
                    // Sonraki baÅŸlÄ±ÄŸa geÃ§
                    if (currentTitleIndex < articleTitles.length - 1) {
                        currentTitleIndex++;
                        speakCurrentTitle();
                    } else {
                        // TÃ¼m baÅŸlÄ±klar okundu
                        resetPlayer();
                        status.textContent = "Makalelerin sonuna ulaÅŸÄ±ldÄ±";
                    }
                }
            };

            utterance.onerror = (event) => {
                console.error('SpeechSynthesis hatasÄ±:', event);
                status.textContent = "KonuÅŸma sÄ±rasÄ±nda bir hata oluÅŸtu";
            };
        }

        // Åu anki baÅŸlÄ±ÄŸÄ± oku
        function speakCurrentTitle() {
            updateDisplay();
            
            const title = articleTitles[currentTitleIndex];
            createUtterance(title);
            synth.speak(utterance);
            
            status.textContent = "KonuÅŸuyor...";
            updateButtonState(true);
        }

        // GÃ¶rÃ¼ntÃ¼yÃ¼ gÃ¼ncelle
        function updateDisplay() {
            // BaÅŸlÄ±ÄŸÄ± gÃ¶ster
            currentTitle.textContent = articleTitles[currentTitleIndex];
            
            // PMID varsa PubMed linkini gÃ¶ster
            const pubmedLink = document.getElementById('pubmedLink');
            const pmid = articlePMIDs[currentTitleIndex];
            
            if (pmid && pmid.trim() !== "") {
                pubmedLink.innerHTML = `<a href="https://pubmed.ncbi.nlm.nih.gov/${pmid}" target="_blank">PubMed: ${pmid}</a>`;
            } else {
                pubmedLink.innerHTML = "";
            }
            
            // Ä°ndeksi gÃ¼ncelle
            currentIndex.textContent = currentTitleIndex + 1;
        }

        // DÃ¼ÄŸme durumlarÄ±nÄ± gÃ¼ncelle
        function updateButtonState(isPlaying) {
            playButton.disabled = isPlaying;
            pauseButton.disabled = !isPlaying;
            stopButton.disabled = !isPlaying;
            prevButton.disabled = currentTitleIndex === 0 || isPlaying;
            nextButton.disabled = currentTitleIndex >= articleTitles.length - 1 || isPlaying;
        }

        // OynatÄ±cÄ±yÄ± sÄ±fÄ±rla
        function resetPlayer() {
            synth.cancel();
            isPaused = false;
            updateButtonState(false);
            status.textContent = "HazÄ±r";
        }

        // Event handler'lar
        function play() {
            if (synth.speaking && isPaused) {
                // DuraklatÄ±lmÄ±ÅŸsa devam et
                synth.resume();
                isPaused = false;
                status.textContent = "KonuÅŸuyor...";
            } else {
                // Yeni konuÅŸma baÅŸlat
                speakCurrentTitle();
            }
            updateButtonState(true);
        }

        function pause() {
            if (synth.speaking) {
                synth.pause();
                isPaused = true;
                status.textContent = "DuraklatÄ±ldÄ±";
            }
        }

        function stop() {
            resetPlayer();
        }

        function previous() {
            if (currentTitleIndex > 0) {
                currentTitleIndex--;
                updateDisplay();
            }
        }

        function next() {
            if (currentTitleIndex < articleTitles.length - 1) {
                currentTitleIndex++;
                updateDisplay();
            }
        }

        function updateVolume() {
            if (utterance) {
                utterance.volume = parseFloat(volumeControl.value);
            }
        }

        // Sayfa yÃ¼klendiÄŸinde baÅŸlat
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
